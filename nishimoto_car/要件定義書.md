# 3Dカーゲーム 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
3Dカーゲーム（Babylon.js + Physics 対応）

### 1.2 プロジェクト説明
Web ブラウザ上で動作する 3D カーレーシングゲーム。Babylon.js ゲームエンジンを使用し、リアルタイム物理演算による車両制御、複数コースの選択、衝突検出、スコアシステムを備えている。

### 1.3 開発環境
- **プラットフォーム**: Web（HTML5）
- **使用ライブラリ**: 
  - Babylon.js（3D レンダリング）
  - Cannon.js（物理演算）
- **対応ブラウザ**: Chrome、Firefox、Safari、Edge 等のモダンブラウザ
- **ファイル形式**: 単一 HTML ファイル（1ファイル完結型）

---

## 2. 機能要件

### 2.1 ゲーム基本機能

#### 2.1.1 車両制御
- **前進**: W キー
- **後退**: S キー
- **左折**: A キー
- **右折**: D キー
- **視点変更**: マウス操作（第一人称視点）
- **ハンドル操作**: マウス X 軸で車両のステアリング制御

#### 2.1.2 物理演算
- 車両の重力、加速度、速度、回転の物理的シミュレーション
- コース上での衝突検出（壁、障害物）
- 車両の衝突時のダメージ表示

#### 2.1.3 コースシステム
- **複数コース選択機能**: UI から異なるコースを選択可能
- **デフォルトコース**: プリセットされた 3D コース
- **ビットマップコース**: PNG/BMP 画像をアップロードしてコースを生成可能
- **コース切り替え**: ゲーム中もコース変更が可能

#### 2.1.4 ゲームモード
- **タイムアタック**: 指定時間内でゴール到達を目指すモード
- **フリーラン**: 制限時間なしで自由にコースを走行

#### 2.1.5 ゴール・リスポーン機能
- ゴール地点の判定とゴール画面の表示
- ゴール後のスコア表示
- スタート地点へのリスポーン機能

### 2.2 ユーザーインターフェース（UI）

#### 2.2.1 HUD（Head-Up Display）
- **表示内容**:
  - 現在の速度
  - エンジン回転数（RPM）
  - ギア（D: Drive、R: Reverse など）
  - ゲーム時間（経過時間）
  - タイムアタック残り時間
  - 現在の位置情報（X, Y, Z 座標）
- **配置**: 画面左上、透過背景（黒背景 65% 不透明）

#### 2.2.2 ヘルプ表示
- **位置**: 画面右上
- **内容**: キーバインド、マウス操作方法、ゲーム機能の説明
- **表示**: デフォルトで表示、非表示オプション

#### 2.2.3 コースセレクター
- **位置**: 画面上部中央
- **機能**: ボタンクリックでコース切り替え
- **表示形式**: 複数のコースボタン（アクティブなコースはハイライト表示）

#### 2.2.4 メッセージ表示
- **カウントダウン**: ゲーム開始前のカウントダウン（3, 2, 1...）
- **ゴール通知**: ゴール到達時のメッセージ
- **表示形式**: 画面中央、黄色テキスト、半透明背景

#### 2.2.5 ポーズ機能
- **ポーズ画面**: P キーでゲームを一時停止
- **表示内容**: ポーズ状態の表示、再開・終了オプション
- **スタイル**: 画面中央、半透明オーバーレイ

#### 2.2.6 ビットマップコース読み込み UI
- **ファイル選択**: PNG/BMP 画像のアップロード機能
- **位置**: コース選択エリア近辺
- **フィードバック**: 読み込み成功/失敗の通知

---

## 3. 非機能要件

### 3.1 パフォーマンス
- **フレームレート**: 60 FPS を目標
- **レスポンス時間**: キー入力から車両動作まで 50ms 以内

### 3.2 互換性
- **OS**: Windows、macOS、Linux
- **ブラウザ**: 最新版の Chrome、Firefox、Safari、Edge
- **デバイス**: デスクトップ PC、ノートパソコン（タッチ対応も推奨）

### 3.3 視認性
- **配色**: ダークテーマ（背景黒、テキスト白）
- **フォント**: システムフォント（Segoe UI、San Francisco 等）
- **テキストサイズ**: HUD 14px、ヘルプ 13px

### 3.4 ファイル構成
- **単一ファイル**: HTML、CSS、JavaScript をすべて 1 つの index.html に統合
- **外部依存**: Babylon.js、Cannon.js の CDN リンク

---

## 4. データ要件

### 4.1 データ出力
- **スコア情報**: ゴール時間、ラップタイム
- **ゲーム状態**: 車両の位置、速度、回転角度（デバッグ用に HUD に表示）

### 4.2 外部ファイル
- **ビットマップコース**: PNG/BMP 画像ファイル（ユーザーがアップロード）

---

## 5. 制約条件

### 5.1 技術的制約
- **HTML5 標準機能のみ利用**: Flash 等の非標準技術は不使用
- **CDN 依存**: Babylon.js、Cannon.js は CDN から読み込み
- **ローカルストレージ**: ゲーム設定やスコア保存は未実装（要検討）

### 5.2 デザイン制約
- **リアルな物理シミュレーション**: より正確な車両制御を提供
- **シンプル UI**: ゲーム性を損なわないミニマルな設計

---

## 6. ユースケース

### 6.1 標準的なゲームプレイフロー
1. ユーザーがブラウザで `index.html` を開く
2. ゲーム画面が読み込まれ、UI が表示される
3. コースを選択（またはデフォルトコースで開始）
4. キーボード操作で車両を制御
5. ゴール地点に到達するとゴール画面が表示される
6. スコア確認後、リスタートまたはコース変更

### 6.2 ポーズ機能の利用
1. ゲーム中に P キーを押す
2. ポーズオーバーレイが表示される
3. ユーザーが再開または終了を選択

### 6.3 カスタムコース（ビットマップ）の利用
1. 「ビットマップコース」から画像をアップロード
2. 画像が自動的にコースに変換される
3. 新しいコースでゲームプレイが可能

---

## 7. テスト要件

### 7.1 機能テスト
- [ ] 車両操作（W、A、S、D キー）が正常に動作すること
- [ ] マウス視点変更が滑らかに動作すること
- [ ] 物理演算（衝突、加速度）が正常に機能すること
- [ ] コース切り替えがリアルタイムで動作すること
- [ ] ゴール判定が正確に動作すること
- [ ] タイマー機能が正確に動作すること

### 7.2 互換性テスト
- [ ] Chrome での動作確認
- [ ] Firefox での動作確認
- [ ] Safari での動作確認
- [ ] Edge での動作確認

### 7.3 パフォーマンステスト
- [ ] 60 FPS の安定稼働確認
- [ ] CPU/GPU 使用率の確認

---

## 8. 今後の拡張案（Out of Scope）

- **マルチプレイヤー**: 複数プレイヤーでのレース
- **サウンドエフェクト**: エンジン音、衝突音
- **ランキング機能**: オンラインスコア保存と共有
- **モバイル最適化**: タッチ操作の完全対応
- **高度な AI**: NPC ドライバーの実装
- **カスタマイズ**: 車両デザイン、色、パフォーマンスのカスタマイズ

---

## 9. 成功基準

- [ ] ゲームが正常にロードされること
- [ ] キーボード操作で車両を思い通りに制御できること
- [ ] 複数コースの切り替えが可能であること
- [ ] ゴール判定とスコア表示が機能すること
- [ ] 60 FPS の安定稼働を達成すること
- [ ] 主要ブラウザで動作すること

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| HUD | Head-Up Display（ゲーム画面上に情報を表示するUI） |
| RPM | Revolutions Per Minute（エンジン回転数） |
| Babylon.js | Web 3D グラフィックスライブラリ |
| Cannon.js | JavaScript 物理演算エンジン |
| フレームレート | 1秒間に表示される画像フレーム数（FPS） |
| ポーズ | ゲームの一時停止 |
| リスポーン | ゲーム開始地点への復帰 |

---

**作成日**: 2026年1月13日  
**バージョン**: 1.0  
**ステータス**: 完成（実装進行中）
