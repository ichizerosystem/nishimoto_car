# nishimoto_car

3D カーレーシングゲーム（Babylon.js + Physics 対応）

## 🎮 最新機能：天候・時間帯システム（完全実装）

### 概要
リアルな環境設定により、プレイ体験が大きく変わります。複数の方法で環境を自由に変更できます。

### 🎛️ 環境設定方法

#### 1. **環境設定ボタン（UIボタン）**
- 左下コントロールパネルの「🌍 環境設定」ボタンをクリック
- モーダルダイアログが開き、時間帯と天候を選択可能

#### 2. **キーボードショートカット**
- **E キー**: 環境設定モーダルを開く
- **Esc キー**: モーダルを閉じる
- モーダル内のボタンをクリックして、リアルタイムで環境変更

#### 3. **対応プラットフォーム**
- マウスクリック（デスクトップ）
- キーボード操作（全デバイス）
- モーダルダイアログまたはボタンベースの操作

### 実装機能

#### 1️⃣ **時間帯システム**
- 🌅 **朝（明け方）** - 暖かいオレンジ色の光、軟らかい影
- ☀️ **昼（真昼）** - 明るく鮮やかな青空、強い日差し
- 🌇 **夕方（夕焼け）** - 温かいオレンジ色、ロマンチックな雰囲気
- 🌙 **夜（暗い）** - 薄暗い青色、月明かりのような照明

#### 2️⃣ **天候システム**
- ☀️ **晴れ** - クリアな空、最高の視認性
- ☁️ **曇り** - 薄い白い空、柔らかい光
- 🌧️ **雨** - 暗い空、フォグが濃くなり、視認性が低下

#### 3️⃣ **ライティング調整**
各時間帯・天候の組み合わせ（12パターン）に対応：
- Hemispherical Light（環境光）の強度と色を動的変更
- Directional Light（太陽光）の方向・強度を時間帯に応じて調整
- フォグの色と密度を環境に合わせて変更
- Ambient Color を適切に設定

#### 4️⃣ **スカイボックス**
- 時間帯・天候に応じて空の色が自動で変更
- Box メッシュで 300×300×300 の立方体空間を生成
- Emissive Material で光源効果を実現

#### 5️⃣ **永続化**
- LocalStorage を使用して設定を保存
- ゲーム終了後も選択した時間帯・天候が復元される

### 使用方法

#### **方法1: 環境設定ボタン（推奨）**
1. 左下コントロールパネルの「🌍 環境設定」ボタンをクリック
2. モーダルダイアログが開く
3. 時間帯を4つから選択：
   - 🌅 朝（明け方）
   - ☀️ 昼（真昼）
   - 🌇 夕方（夕焼け）
   - 🌙 夜（暗い）
4. 天候を3つから選択：
   - ☀️ 晴れ
   - ☁️ 曇り
   - 🌧️ 雨
5. ボタンをクリックするとリアルタイムで環境が変更
6. 「完了」ボタンで閉じる

#### **方法2: キーボードショートカット**
- **E キー**: 環境設定モーダルを開く（どこからでも）
- **Esc キー**: モーダルを閉じる
- モーダル内でボタンをクリック

#### **方法3: 設定の保存と復元**
- 選択した環境設定は自動的に保存される
- ゲーム終了後、再度開いた時に前回の設定が復元される

左下の天候パネル（旧UI）は非表示になっており、環境設定はモーダルダイアログから変更します。

### 技術実装

#### WeatherSystem クラス
```javascript
class WeatherSystem {
  constructor(scene);      // シーンを引数に初期化
  updateLighting();        // ライティング設定を更新
  getLightingConfig();     // 時間帯・天候に応じた設定を取得
  setTimeOfDay(time);      // 時間帯を設定
  setWeather(weather);     // 天候を設定
  initSkybox();            // スカイボックスを初期化
  updateSkyboxColor();     // スカイボックスの色を更新
}
```

#### ライティング設定パラメータ（各組み合わせ用）
- Hemisphere Light Intensity: 0.2～0.8
- Ground Color: RGB値で環境に合わせて調整
- Directional Light Intensity: 0.1～0.9
- Light Direction: (x, y, z) で方向設定
- Fog Color: RGB値で時間帯・天候に対応
- Fog Density: 0.01～0.032
- Ambient Color: RGB値で全体的な色合いを調整

### ファイル構成
- `index.html` - 全機能を含む単一HTML ファイル
  - CSS: 天候パネルのスタイル定義
  - HTML: UIパネルの定義
  - JavaScript: WeatherSystem クラス、イベントリスナー、LocalStorage連携

### ブラウザ互換性
- Chrome ✅
- Firefox ✅
- Safari ✅
- Edge ✅

### パフォーマンス
- スカイボックス更新: フレームスキップなし
- ライティング更新: 変更時のみ実行
- フォグ設定: リアルタイム変更可能

---

**実装日**: 2026年1月22日  
**バージョン**: 2.0 (天候・時間帯システム搭載)
